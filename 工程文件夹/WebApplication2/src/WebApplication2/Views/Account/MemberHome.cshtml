@model WebApplication2.Models.MemberHomeModel
@{
    ViewBag.Title = "会员中心";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
@section Scripts
{
    @{ await Html.RenderPartialAsync("_ValidationScriptsPartial"); }
    <script>
        function modiInfo() {
            var val = document.getElementById("btnModiInfo").value;
            if (val == "修改信息") {
                setEditable();
            }
            else {
                //1。测试用户名是否唯一。如果不唯一则提示并中断提交
                var xmlhttp = new XMLHttpRequest();
                var curUserId = document.getElementById("userId").value;
                //2。提交有效信息，更新成功
                xmlhttp.onreadystatechange = function () {
                    if (xmlhttp.readyState == 4 && xmlhttp.status == 200)
                        if (xmlhttp.responseText.trim() == "1" || xmlhttp.responseText.trim() == "0")
                            setReadonly();//3。恢复到只读状态
                        else
                            alert("信息提交不成功，请重新尝试！");
                }
                xmlhttp.open("post", "/Account/updateMemberInfo", true);
                xmlhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
                xmlhttp.send("memberId=" + curUserId +
                            "&memberSex=" + document.getElementById("memberSex").value +
                            "&memberTel=" + document.getElementById("memberTel").value
                             + "&memberQq=" + document.getElementById("memberQq").value
                        );
            }
        }
        function setEditable() {
            document.getElementById("memberSex").style.border = "solid";
            document.getElementById("memberSex").readOnly = false;
            document.getElementById("memberTel").style.border = "solid";
            document.getElementById("memberTel").readOnly = false;
            document.getElementById("memberQq").style.border = "solid";
            document.getElementById("memberQq").readOnly = false;
            document.getElementById("btnModiInfo").value = "提交信息";
        }
        function modiPWD() {
            document.getElementById("pwdBlk").style.display = "block";
        }
        function setReadonly() {
            document.getElementById("memberSex").style.border = "none";
            document.getElementById("memberSex").readOnly = true;
            document.getElementById("memberTel").style.border = "none";
            document.getElementById("memberTel").readOnly = true;
            document.getElementById("memberQq").style.border = "none";
            document.getElementById("memberQq").readOnly = true;
            document.getElementById("btnModiInfo").value = "修改信息";
        }
    </script>
}
<style type="text/css">
    .grid {
        margin: 2px;
        border-collapse: collapse;
        width: 730px;
    }

    .head {
        background-color: #E8E8E8;
        font-weight: bold;
        color: #FFF;
    }

    .grid th, .grid td {
        border: 1px solid #C0C0C0;
        padding: 2px;
    }

    .alt {
        background-color: #E8E8E8;
        color: #000;
    }

    .product {
        width: 200px;
        font-weight: bold;
    }
</style>

<div>
    <table style="width: 100%; height: 688px;">
        <tr>
            <td style="width: 297px;vertical-align:top;">
                <h3>会员信息</h3>
                <input type="hidden" id="userId" value="@ViewBag.uid" />
                <table border="1" style="border-collapse:collapse;">
                    <tr>
                        <td style="width: 70px;text-align:right;">性别</td>
                        <td style="width: 158px;text-align:left;">
                            <input type="text" id="memberSex" name="memberSex" readOnly="true" style="Width:156px;border:none;" value="@Model.CustomerInfo.CustomerSex" />
                        </td>
                    </tr>

                    <tr>
                        <td style="width: 70px;text-align:right;">移动电话 </td>
                        <td style="width: 158px;text-align:left;">
                            <input type="text" id="memberTel" name="memberTel" readOnly="true" style="Width:156px;border:none;" value="@Model.CustomerInfo.CustomerTel" />
                        </td>
                    </tr>
                    <tr>
                        <td style="width: 70px;text-align:right;">QQ号码 </td>
                        <td style="width: 158px;text-align:left;">
                            <input type="text" id="memberQq" name="memberQq" readOnly="true" style="Width:156px;border:none" value="@Model.CustomerInfo.QqNum" />
                        </td>
                    </tr>
                </table><br />
                <input type="button" ID="btnModiInfo" value="修改信息" onclick="javascript: modiInfo();" />
                <input type="button" ID="btnModiPWD" value="修改密码" onclick="javascript: modiPWD();" /><br /><br />
                <form id="baseInfo" class="col-md-12" asp-controller="Account" asp-action="MemberHome" method="post">
                    <div id="pwdBlk" style="display:@ViewBag.pwdDisp">
                        <div asp-validation-summary="All" class="text-danger"></div>
                        <div class="form-group" style="font:100">
                            <label asp-for="OldPassword" class="col-md-5 control-label text-right"></label>
                            <div class="col-md-7 text-left">
                                <input asp-for="OldPassword" class="form-control" />
                                <span asp-validation-for="OldPassword" class="text-danger"></span>
                            </div>
                        </div>
                        <div class="form-group">
                            <label asp-for="NewPassword" class="col-md-5 control-label text-right"></label>
                            <div class="col-md-7 text-left">
                                <input asp-for="NewPassword" class="form-control" />
                                <span asp-validation-for="NewPassword" class="text-danger"></span>
                            </div>
                        </div>
                        <div class="form-group">
                            <label asp-for="ConfirmPassword" class="col-md-5 control-label text-right"></label>
                            <div class="col-md-7 text-left">
                                <input asp-for="ConfirmPassword" class="form-control" />
                                <span asp-validation-for="ConfirmPassword" class="text-danger"></span>
                            </div>
                        </div>
                        <div class="form-group">
                            <div class="col-md-10">
                                <button type="submit" class="btn btn-default">提交新密码</button>
                            </div>
                        </div>
                    </div>
                </form>
            </td>
    </table>
</div>
